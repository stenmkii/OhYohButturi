<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>原子物理・原子核 演習システム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        .hidden { display: none; }
        .correct { color: #059669; font-weight: bold; }
        .incorrect { color: #dc2626; font-weight: bold; }
        .mjx-chtml { font-size: 110% !important; }
        input::placeholder { font-size: 0.9rem; color: #94a3b8; }
        .explanation-text { line-height: 1.8; }
        .math-tex { min-height: 1.2em; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">

<div id="app" class="max-w-3xl mx-auto p-4 md:p-8">
    <header class="mb-8 text-center">
        <h1 class="text-3xl font-bold text-slate-800">原子物理・原子核 演習</h1>
        <p class="text-slate-600 mt-2">光子・物質波 ＆ 原子・原子核・素粒子 演習システム</p>
    </header>

    <div id="menu" class="grid grid-cols-1 gap-4 mb-8">
        <button onclick="startSession(8)" class="bg-white p-4 rounded-xl shadow border-l-4 border-indigo-500 text-left hover:bg-indigo-50 transition">
            <h2 class="font-bold">第8回：光子と物質波</h2>
            <p class="text-sm text-slate-500">演習11〜14 ＋ 応用問題</p>
        </button>
        <button onclick="startSession(9)" class="bg-white p-4 rounded-xl shadow border-l-4 border-blue-500 text-left hover:bg-blue-50 transition">
            <h2 class="font-bold">第9回：原子の構造とスペクトル</h2>
            <p class="text-sm text-slate-500">公式 ＋ 演習15, 16</p>
        </button>
        <button onclick="startSession(10)" class="bg-white p-4 rounded-xl shadow border-l-4 border-green-500 text-left hover:bg-green-50 transition">
            <h2 class="font-bold">第10回：水素原子の定常状態</h2>
            <p class="text-sm text-slate-500">公式 ＋ 演習17〜20</p>
        </button>
        <button onclick="startSession(11)" class="bg-white p-4 rounded-xl shadow border-l-4 border-yellow-500 text-left hover:bg-yellow-50 transition">
            <h2 class="font-bold">第11回：構成粒子と同位体</h2>
            <p class="text-sm text-slate-500">演習21〜23</p>
        </button>
        <button onclick="startSession(12)" class="bg-white p-4 rounded-xl shadow border-l-4 border-red-500 text-left hover:bg-red-50 transition">
            <h2 class="font-bold">第12回：原子核の崩壊</h2>
            <p class="text-sm text-slate-500">公式 ＋ 演習24〜28</p>
        </button>
        <button onclick="startSession(13)" class="bg-white p-4 rounded-xl shadow border-l-4 border-purple-500 text-left hover:bg-purple-50 transition">
            <h2 class="font-bold">第13回：放射線の性質</h2>
            <p class="text-sm text-slate-500">演習29, 30</p>
        </button>
        <!-- 追加セッション -->
        <button onclick="startSession(14)" class="bg-white p-4 rounded-xl shadow border-l-4 border-orange-500 text-left hover:bg-orange-50 transition">
            <h2 class="font-bold">第14回：核反応とエネルギー</h2>
            <p class="text-sm text-slate-500">演習31, 32（質量欠損・結合エネルギー）</p>
        </button>
        <button onclick="startSession(15)" class="bg-white p-4 rounded-xl shadow border-l-4 border-pink-500 text-left hover:bg-pink-50 transition">
            <h2 class="font-bold">第15回：素粒子とクォーク模型</h2>
            <p class="text-sm text-slate-500">演習35〜38（核融合・クォークの電荷）</p>
        </button>
    </div>

    <div id="question-container" class="hidden bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
        <div class="flex justify-between items-center mb-4 border-b pb-2">
            <span id="question-title" class="text-sm font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full"></span>
            <button onclick="backToMenu()" class="text-slate-400 hover:text-slate-600 text-sm">← 戻る</button>
        </div>
        
        <div id="question-text" class="text-slate-800 leading-relaxed mb-6 text-lg math-tex"></div>
        <div id="interaction-area" class="space-y-4"></div>
        <div id="feedback" class="mt-6 p-6 rounded-xl hidden border"></div>

        <div class="mt-8 flex justify-between">
            <button id="submit-btn" onclick="checkAnswer()" class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 shadow-lg transition">回答する</button>
            <button id="next-btn" onclick="nextQuestion()" class="hidden bg-slate-800 text-white px-8 py-3 rounded-xl font-bold hover:bg-slate-900 shadow-lg transition">次の問題へ</button>
        </div>
    </div>
</div>

<script>
const questions = [
    // --- 第8回 ---
    {
        id: 11.1, session: 8, title: "演習11(1)：コンプトン効果",
        text: "コンプトン散乱における「運動量保存の法則」を考えます。入射光子の運動量を $p$、散乱光子の運動量を $p'$、電子の運動量を $p_e$ としたとき、ベクトルによる正しい表現はどれですか？",
        type: "select", options: ["$\vec{p} = \vec{p}' + \vec{p}_e$", "$\vec{p} + \vec{p}' = \vec{p}_e$", "$p = p' + p_e$ (スカラー和)"],
        answer: "$\vec{p} = \vec{p}' + \vec{p}_e$",
        explanation: "運動量はベクトル量です。入射した光子の運動量は、散乱された光子の運動量と、はじき飛ばされた電子の運動量の和に等しくなります。"
    },
    {
        id: 11.2, session: 8, title: "演習11(2)：コンプトン効果",
        text: "エネルギー保存の法則の式として正しいものを選びなさい。（散乱後の電子の速さを $v$ とする。非相対論的扱い）",
        type: "select", options: ["$\frac{hc}{\lambda} = \frac{hc}{\lambda'} + \frac{1}{2}mv^2$", "$\frac{hc}{\lambda} + \frac{hc}{\lambda'} = \frac{1}{2}mv^2$", "$\frac{h}{\lambda} = \frac{h}{\lambda'} + mv$"],
        answer: "$\frac{hc}{\lambda} = \frac{hc}{\lambda'} + \frac{1}{2}mv^2$",
        explanation: "入射光子のエネルギー $E=hc/\lambda$ は、散乱光子のエネルギー $E'=hc/\lambda'$ と、電子が受け取った運動エネルギー $K=\frac{1}{2}mv^2$ の和になります。"
    },
    {
        id: 12.1, session: 8, title: "演習12(1)：打球の物質波",
        text: "質量 $0.15 \text{ kg}$、時速 $193 \text{ km}$（約 $53.6 \text{ m/s}$）の打球の物質波の波長 $\lambda$ を求めよ。<br><small>$h = 6.6 \times 10^{-34} \text{ J}\cdot\text{s}$</small>",
        type: "input", answer: "8.2e-35", unit: "m", digits: 2,
        explanation: "ドブロイの式 $\lambda = \frac{h}{mv}$ を用います。"
    },
    {
        id: 13.1, session: 8, title: "演習13(1)：電子波の波長",
        text: "電圧 $V$ で加速された電子（質量 $m$, 電荷 $-e$）の物質波の波長 $\lambda$ を表す式はどれか。",
        type: "select", options: ["$\lambda = \frac{h}{\sqrt{2meV}}$", "$\lambda = \frac{h}{\sqrt{meV}}$", "$\lambda = \frac{\sqrt{2meV}}{h}$"],
        answer: "$\lambda = \frac{h}{\sqrt{2meV}}$",
        explanation: "エネルギー保存則 $eV = p^2/(2m)$ より $p = \sqrt{2meV}$。これを $\lambda = h/p$ に代入します。"
    },

    // --- 第9回 ---
    {
        id: "9-f1", session: 9, title: "第9回：公式確認",
        text: "光子のエネルギー $E$ を表す正しい式はどれですか？",
        type: "select", options: ["$E = h\nu = \frac{hc}{\lambda}$", "$E = \frac{h}{\nu}$", "$E = h\lambda$"],
        answer: "$E = h\nu = \frac{hc}{\lambda}$", 
        explanation: "光子のエネルギーは振動数に比例します。"
    },

    // --- 第10回 ---
    {
        id: 18.1, session: 10, title: "演習18(1)",
        text: "水素原子の基底状態のエネルギー $E_1 \text{ [J]}$ を求めよ。",
        type: "input", answer: "-2.2e-18", unit: "J", digits: 2,
        explanation: "$E_1 \approx -2.18 \times 10^{-18} \text{ J}$。"
    },

    // --- 第11回 ---
    {
        id: 21, session: 11, title: "演習21",
        text: "$^{27}_{13}\text{Al}$ 原子核に含まれる中性子の数はいくつか。",
        type: "input", answer: "14", unit: "個", digits: 0,
        explanation: "$27 - 13 = 14$ です。"
    },

    // --- 第12回 ---
    {
        id: 26, session: 12, title: "演習26",
        text: "$^{232}_{90}\text{Th} \rightarrow ^{208}_{82}\text{Pb}$ の過程で $\beta$ 崩壊は何回起きるか。",
        type: "input", answer: "4", unit: "回", digits: 0,
        explanation: "$\alpha$崩壊6回で原子番号は $90-12=78$。$\beta$崩壊で原子番号が1ずつ増えるので、$82-78=4$回です。"
    },

    // --- 第13回 ---
    {
        id: 29, session: 13, title: "演習29",
        text: "割合が $1/8$ の木片の年代（半減期 5700年）。",
        type: "input", answer: "1.7e4", unit: "年前", digits: 2,
        explanation: "$(1/2)^3 = 1/8$ なので 3半減期分。$3 \times 5700 = 17100$ 年。"
    },

    // --- 第14回 ---
    {
        id: 31, session: 14, title: "演習31：1uのエネルギー換算",
        text: "原子質量単位 $1 \text{ u}$ の質量に相当するエネルギーは何 $\text{ MeV}$ か。<br><small>$1 \text{ u} = 1.66054 \times 10^{-27} \text{ kg}, c = 2.99792 \times 10^8 \text{ m/s}, e = 1.6022 \times 10^{-19} \text{ C}$</small>",
        type: "input", answer: "931.5", unit: "MeV", digits: 4,
        explanation: "$E = mc^2$ を計算し、最後に $e$ で割って $\text{eV}$ 単位にします。<br>$$ E = \frac{(1.66054 \times 10^{-27}) \times (2.99792 \times 10^8)^2}{1.6022 \times 10^{-19}} \approx 9.315 \times 10^8 \text{ eV} = 931.5 \text{ MeV} $$"
    },
    {
        id: 32.1, session: 14, title: "演習32(1)：ウランの質量欠損",
        text: "$^{235}_{92}\text{U}$ の原子核質量を $235.0439 \text{ u}$ とする。質量欠損 $\Delta m$ はいくらか。<br><small>陽子 $m_p = 1.00728 \text{ u}$, 中性子 $m_n = 1.00866 \text{ u}$</small>",
        type: "input", answer: "1.9149", unit: "u", digits: 5,
        explanation: "構成粒子の合計質量と原子核の質量の差を求めます。<br>$\Delta m = (92 \times 1.00728 + 143 \times 1.00866) - 235.0439 = 1.91494 \text{ u}$。"
    },
    {
        id: 32.2, session: 14, title: "演習32(2)：結合エネルギー",
        text: "$^{235}_{92}\text{U}$ の「1核子あたりの結合エネルギー」は何 $\text{ MeV}$ か。<br><small>$\Delta m = 1.9149 \text{ u}, 1 \text{ u} = 931.48 \text{ MeV}$</small>",
        type: "input", answer: "7.59", unit: "MeV/A", digits: 3,
        explanation: "全結合エネルギーは $1.9149 \times 931.48 \approx 1783.7 \text{ MeV}$。これを核子数 $235$ で割ると、約 $7.59 \text{ MeV}$ となります。"
    },

    // --- 第15回 ---
    {
        id: 35.1, session: 15, title: "演習35(1)：核融合",
        text: "2個の陽子 $^{1}\text{H}$ と2個の中性子 $\text{n}$ が結合して $^{4}\text{He}$ が生成する反応式を選べ。",
        type: "select", options: ["$2^{1}_{1}\text{H} + 2^{1}_{0}\text{n} \rightarrow ^{4}_{2}\text{He}$", "$^{2}_{1}\text{H} + ^{2}_{1}\text{H} \rightarrow ^{4}_{2}\text{He}$", "$4^{1}_{1}\text{H} \rightarrow ^{4}_{2}\text{He} + 2\text{e}^+$"],
        answer: "$2^{1}_{1}\text{H} + 2^{1}_{0}\text{n} \rightarrow ^{4}_{2}\text{He}$",
        explanation: "陽子（水素原子核）2個と中性子2個がそのまま合体する反応です。"
    },
    {
        id: 35.2, session: 15, title: "演習35(2)：ヘリウム合成の質量減少",
        text: "反応後の質量減少 $\Delta m$ は何 $\text{ kg}$ か。<br><small>H:1.0073u, n:1.0087u, He:4.0015u, 1u=1.66e-27kg</small>",
        type: "input", answer: "5.06e-29", unit: "kg", digits: 3,
        explanation: "原子質量単位での減少分は $(2 \times 1.0073 + 2 \times 1.0087) - 4.0015 = 0.0305 \text{ u}$。これを $\text{kg}$ に直すと $0.0305 \times 1.66 \times 10^{-27} \approx 5.06 \times 10^{-29} \text{ kg}$。"
    },
    {
        id: 36.1, session: 15, title: "演習36(1)：太陽の核融合",
        text: "$4^{1}_{1}\text{H} \rightarrow ^{4}_{2}\text{He} + 2\text{e}^+$ の反応で、もとの質量の何 $\text{ %}$ が減少するか。<br><small>H:1.0073u, He:4.0015u, e:0.0005u</small>",
        type: "input", answer: "0.66", unit: "%", digits: 2,
        explanation: "減少分：$4 \times 1.0073 - (4.0015 + 2 \times 0.0005) = 0.0267 \text{ u}$。<br>割合：$(0.0267 / (4 \times 1.0073)) \times 100 \approx 0.662 \text{ %}$。"
    },
    {
        id: 37, session: 15, title: "演習37：クォークの電荷",
        text: "陽子(uud)の電荷が $+e$、中性子(udd)の電荷が $0$ であるとき、uクォークとdクォークの電荷の組み合わせとして正しいものは？",
        type: "select", options: ["u: $+\frac{2}{3}e, \text{ d: } -\frac{1}{3}e$", "u: $+\frac{1}{3}e, \text{ d: } -\frac{2}{3}e$", "u: $+e, \text{ d: } -e$"],
        answer: "u: $+\frac{2}{3}e, \text{ d: } -\frac{1}{3}e$",
        explanation: "連立方程式 $2q_u + q_d = e$ と $q_u + 2q_d = 0$ を解くと導かれます。"
    },
    {
        id: 38, session: 15, title: "演習38：中間子の構成",
        text: "電荷が $+e$ である $\pi^+$ 中間子は、どのクォークと反クォークの組み合わせか？",
        type: "select", options: ["$\text{u}\bar{\text{d}}$", "$\text{u}\bar{\text{u}}$", "$\text{d}\bar{\text{u}}$"],
        answer: "$\text{u}\bar{\text{d}}$",
        explanation: "uの電荷は $+2/3e$、$\bar{\text{d}}$（dの反粒子）の電荷は $+1/3e$（dの符号反転）なので、合計で $+e$ となります。"
    }
];

let currentSessionQuestions = [];
let currentQuestionIndex = 0;

function startSession(sessionNum) {
    currentSessionQuestions = questions.filter(q => q.session === sessionNum);
    if (currentSessionQuestions.length === 0) {
        alert("準備中です。");
        return;
    }
    currentQuestionIndex = 0;
    document.getElementById('menu').classList.add('hidden');
    document.getElementById('question-container').classList.remove('hidden');
    showQuestion();
}

function showQuestion() {
    const q = currentSessionQuestions[currentQuestionIndex];
    document.getElementById('question-title').innerText = q.title;
    document.getElementById('question-text').innerHTML = q.text;
    document.getElementById('feedback').classList.add('hidden');
    document.getElementById('next-btn').classList.add('hidden');
    document.getElementById('submit-btn').classList.remove('hidden');

    const area = document.getElementById('interaction-area');
    area.innerHTML = '';

    if (q.type === 'select') {
        const shuffledOptions = [...q.options].sort(() => Math.random() - 0.5);
        shuffledOptions.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = "w-full text-left p-4 border-2 border-slate-200 rounded-xl hover:border-blue-400 transition mb-3 bg-white shadow-sm";
            btn.innerHTML = opt;
            btn.onclick = () => selectOption(btn, opt);
            area.appendChild(btn);
        });
        area.dataset.value = "";
    } else {
        const inputWrap = document.createElement('div');
        inputWrap.className = "flex items-center space-x-3";
        const input = document.createElement('input');
        input.type = "text";
        input.placeholder = "例: 931.5 や 5.06e-29";
        input.className = "flex-1 p-4 border-2 border-slate-200 rounded-xl focus:border-blue-500 outline-none text-xl font-mono";
        input.id = "user-input";
        inputWrap.appendChild(input);
        if (q.unit) {
            const unitLabel = document.createElement('span');
            unitLabel.className = "text-xl font-bold text-slate-600";
            unitLabel.innerText = q.unit;
            inputWrap.appendChild(unitLabel);
        }
        area.appendChild(inputWrap);
    }
    
    renderMath();
}

function renderMath() {
    if (window.MathJax && MathJax.typesetPromise) {
        setTimeout(() => {
            MathJax.typesetPromise([document.getElementById('question-container')]).catch(err => console.log(err));
        }, 50);
    }
}

function selectOption(btn, val) {
    const parent = btn.parentElement;
    Array.from(parent.children).forEach(c => {
        c.classList.remove('border-blue-500', 'bg-blue-50');
        c.classList.add('border-slate-200', 'bg-white');
    });
    btn.classList.replace('border-slate-200', 'border-blue-500');
    btn.classList.add('bg-blue-50');
    parent.dataset.value = val;
}

function checkAnswer() {
    const q = currentSessionQuestions[currentQuestionIndex];
    let isCorrect = false;
    let userVal = "";

    if (q.type === 'select') {
        userVal = document.getElementById('interaction-area').dataset.value;
        if (!userVal) { alert("選択してください"); return; }
        isCorrect = (userVal === q.answer);
    } else {
        const rawInput = document.getElementById('user-input').value.trim().toLowerCase();
        if (!rawInput) { alert("回答を入力してください"); return; }
        const userNum = parseFloat(rawInput);
        const expectedNum = parseFloat(q.answer);
        
        if (q.digits === 0) {
            isCorrect = (Math.abs(userNum - expectedNum) < 0.1);
        } else {
            const formattedUser = userNum.toExponential(q.digits - 1);
            const formattedExpected = expectedNum.toExponential(q.digits - 1);
            isCorrect = (formattedUser === formattedExpected);
        }
    }

    const feedback = document.getElementById('feedback');
    feedback.classList.remove('hidden');
    feedback.className = `mt-6 p-6 rounded-xl border ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`;
    feedback.innerHTML = `
        <p class="text-xl mb-2 ${isCorrect ? 'correct' : 'incorrect'}">${isCorrect ? '✨ 正解！' : '❌ 不正解...'}</p>
        <p class="text-md text-slate-700 mb-4"><strong>正解:</strong> ${q.answer} ${q.unit || ''}</p>
        <div class="mt-4 text-slate-600 text-[0.95rem] explanation-text border-t border-slate-200 pt-4">
            <p class="font-bold text-slate-800 mb-2">【解説】</p>
            ${q.explanation}
        </div>
    `;

    document.getElementById('submit-btn').classList.add('hidden');
    document.getElementById('next-btn').classList.remove('hidden');
    
    renderMath();
}

function nextQuestion() {
    currentQuestionIndex++;
    if (currentQuestionIndex < currentSessionQuestions.length) {
        showQuestion();
    } else {
        alert("セッション完了！メニューに戻ります。");
        backToMenu();
    }
}

function backToMenu() {
    document.getElementById('menu').classList.remove('hidden');
    document.getElementById('question-container').classList.add('hidden');
}
</script>
</body>
</html>
