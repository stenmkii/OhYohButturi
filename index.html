<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>原子物理・原子核 演習システム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        .hidden { display: none; }
        .correct { color: #059669; font-weight: bold; }
        .incorrect { color: #dc2626; font-weight: bold; }
        .mjx-chtml { font-size: 110% !important; }
        input::placeholder { font-size: 0.9rem; color: #94a3b8; }
        .explanation-text { line-height: 1.8; }
        .math-tex { min-height: 1.2em; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">

<div id="app" class="max-w-3xl mx-auto p-4 md:p-8">
    <header class="mb-8 text-center">
        <h1 class="text-3xl font-bold text-slate-800">原子物理・原子核 演習</h1>
        <p class="text-slate-600 mt-2">光子・物質波 ＆ 原子・原子核 演習システム</p>
    </header>

    <div id="menu" class="grid grid-cols-1 gap-4 mb-8">
        <!-- 追加された第8回 -->
        <button onclick="startSession(8)" class="bg-white p-4 rounded-xl shadow border-l-4 border-indigo-500 text-left hover:bg-indigo-50 transition">
            <h2 class="font-bold">第8回：光子と物質波</h2>
            <p class="text-sm text-slate-500">演習11〜14 ＋ 応用問題（コンプトン効果・物質波）</p>
        </button>
        <button onclick="startSession(9)" class="bg-white p-4 rounded-xl shadow border-l-4 border-blue-500 text-left hover:bg-blue-50 transition">
            <h2 class="font-bold">第9回：原子の構造とスペクトル</h2>
            <p class="text-sm text-slate-500">公式 ＋ 演習15, 16</p>
        </button>
        <button onclick="startSession(10)" class="bg-white p-4 rounded-xl shadow border-l-4 border-green-500 text-left hover:bg-green-50 transition">
            <h2 class="font-bold">第10回：水素原子の定常状態</h2>
            <p class="text-sm text-slate-500">公式 ＋ 演習17〜20</p>
        </button>
        <button onclick="startSession(11)" class="bg-white p-4 rounded-xl shadow border-l-4 border-yellow-500 text-left hover:bg-yellow-50 transition">
            <h2 class="font-bold">第11回：構成粒子と同位体</h2>
            <p class="text-sm text-slate-500">演習21〜23</p>
        </button>
        <button onclick="startSession(12)" class="bg-white p-4 rounded-xl shadow border-l-4 border-red-500 text-left hover:bg-red-50 transition">
            <h2 class="font-bold">第12回：原子核の崩壊</h2>
            <p class="text-sm text-slate-500">公式 ＋ 演習24〜28</p>
        </button>
        <button onclick="startSession(13)" class="bg-white p-4 rounded-xl shadow border-l-4 border-purple-500 text-left hover:bg-purple-50 transition">
            <h2 class="font-bold">第13回：放射線の性質</h2>
            <p class="text-sm text-slate-500">演習29, 30</p>
        </button>
    </div>

    <div id="question-container" class="hidden bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
        <div class="flex justify-between items-center mb-4 border-b pb-2">
            <span id="question-title" class="text-sm font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full"></span>
            <button onclick="backToMenu()" class="text-slate-400 hover:text-slate-600 text-sm">← 戻る</button>
        </div>
        
        <div id="question-text" class="text-slate-800 leading-relaxed mb-6 text-lg math-tex"></div>
        <div id="interaction-area" class="space-y-4"></div>
        <div id="feedback" class="mt-6 p-6 rounded-xl hidden border"></div>

        <div class="mt-8 flex justify-between">
            <button id="submit-btn" onclick="checkAnswer()" class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 shadow-lg transition">回答する</button>
            <button id="next-btn" onclick="nextQuestion()" class="hidden bg-slate-800 text-white px-8 py-3 rounded-xl font-bold hover:bg-slate-900 shadow-lg transition">次の問題へ</button>
        </div>
    </div>
</div>

<script>
const questions = [
    // --- 第8回 ---
    {
        id: 11.1, session: 8, title: "演習11(1)：コンプトン効果",
        text: "コンプトン散乱における「運動量保存の法則」を考えます。入射光子の運動量を $p$、散乱光子の運動量を $p'$、電子の運動量を $p_e$ としたとき、ベクトルによる正しい表現はどれですか？",
        type: "select", options: ["$\vec{p} = \vec{p}' + \vec{p}_e$", "$\vec{p} + \vec{p}' = \vec{p}_e$", "$p = p' + p_e$ (スカラー和)"],
        answer: "$\vec{p} = \vec{p}' + \vec{p}_e$",
        explanation: "運動量はベクトル量です。入射した光子の運動量は、散乱された光子の運動量と、はじき飛ばされた電子の運動量の和に等しくなります。"
    },
    {
        id: 11.2, session: 8, title: "演習11(2)：コンプトン効果",
        text: "エネルギー保存の法則の式として正しいものを選びなさい。（散乱後の電子の速さを $v$ とする。非相対論的扱い）",
        type: "select", options: ["$\frac{hc}{\lambda} = \frac{hc}{\lambda'} + \frac{1}{2}mv^2$", "$\frac{hc}{\lambda} + \frac{hc}{\lambda'} = \frac{1}{2}mv^2$", "$\frac{h}{\lambda} = \frac{h}{\lambda'} + mv$"],
        answer: "$\frac{hc}{\lambda} = \frac{hc}{\lambda'} + \frac{1}{2}mv^2$",
        explanation: "入射光子のエネルギー $E=hc/\lambda$ は、散乱光子のエネルギー $E'=hc/\lambda'$ と、電子が受け取った運動エネルギー $K=\frac{1}{2}mv^2$ の和になります。"
    },
    {
        id: 12.1, session: 8, title: "演習12(1)：打球の物質波",
        text: "質量 $0.15 \text{ kg}$、時速 $193 \text{ km}$（約 $53.6 \text{ m/s}$）の打球の物質波の波長 $\lambda$ を求めよ。<br><small>$h = 6.6 \times 10^{-34} \text{ J}\cdot\text{s}$</small>",
        type: "input", answer: "8.2e-35", unit: "m", digits: 2,
        explanation: "ドブロイの式 $\lambda = \frac{h}{mv}$ を用います。<br>$$ \lambda = \frac{6.6 \times 10^{-34}}{0.15 \times 53.6} \approx 8.208 \times 10^{-35} \text{ m} $$<br>極めて短い波長であり、マクロな物体では波動性は無視できることがわかります。"
    },
    {
        id: 13.1, session: 8, title: "演習13(1)：電子波の波長",
        text: "電圧 $V$ で加速された電子（質量 $m$, 電荷 $-e$）の物質波の波長 $\lambda$ を表す式はどれか。",
        type: "select", options: ["$\lambda = \frac{h}{\sqrt{2meV}}$", "$\lambda = \frac{h}{\sqrt{meV}}$", "$\lambda = \frac{\sqrt{2meV}}{h}$"],
        answer: "$\lambda = \frac{h}{\sqrt{2meV}}$",
        explanation: "エネルギー保存則 $eV = \frac{p^2}{2m}$ より $p = \sqrt{2meV}$ です。これをドブロイの式 $\lambda = h/p$ に代入すると導けます。"
    },
    {
        id: 14.1, session: 8, title: "演習14(1)：電子の速さ",
        text: "波長 $\lambda = 5.0 \times 10^{-11} \text{ m}$ をもつ電子の速さ $v$ を求めよ。<br><small>$h = 6.6 \times 10^{-34}, m = 9.1 \times 10^{-31} \text{ kg}$</small>",
        type: "input", answer: "1.5e7", unit: "m/s", digits: 2,
        explanation: "$v = \frac{h}{m\lambda}$ より、<br>$$ v = \frac{6.6 \times 10^{-34}}{9.1 \times 10^{-31} \times 5.0 \times 10^{-11}} \approx 1.45 \times 10^7 \text{ m/s} $$"
    },
    {
        id: "8-app1", session: 8, title: "応用：加速電圧と波長",
        text: "電子顕微鏡において、加速電圧を $100 \text{ V}$ から $400 \text{ V}$ に上げました。このとき、電子波の波長は何倍になりますか。",
        type: "select", options: ["$1/2$ 倍", "$2$ 倍", "$1/4$ 倍", "$4$ 倍"],
        answer: "$1/2$ 倍",
        explanation: "$\lambda = \frac{h}{\sqrt{2meV}}$ より、波長は電圧の平方根に反比例します。電圧が4倍になると、分母が $\sqrt{4}=2$ になるため、波長は $1/2$ 倍になります。"
    },
    {
        id: "8-app2", session: 8, title: "応用：分解能",
        text: "電子顕微鏡の分解能は、波長が短いほど良くなります。電圧を $100 \text{ V} \rightarrow 400 \text{ V}$ にしたとき、分解能はどう変化するか。",
        type: "select", options: ["良くなる（識別できる距離が小さくなる）", "悪くなる（識別できる距離が大きくなる）", "変化しない"],
        answer: "良くなる（識別できる距離が小さくなる）",
        explanation: "電圧を上げると波長が短くなるため、より微細な構造を識別できるようになり、分解能が向上します。"
    },
    {
        id: "8-app3", session: 8, title: "応用：光学顕微鏡との比較",
        text: "電子顕微鏡が光学顕微鏡より圧倒的に分解能が優れている最大の理由はどれか。",
        type: "select", options: ["電子波の波長が可視光より圧倒的に短いから", "電子は電荷を持っていて曲げやすいから", "電子の速度が光速に近いから"],
        answer: "電子波の波長が可視光より圧倒的に短いから",
        explanation: "分解能は波長に比例します。可視光の波長（数百nm）に比べ、電子波の波長（加速電圧によりますが0.01nm程度も可能）は圧倒的に短いため、より細かいものが観察できます。"
    },

    // --- 第9回 ---
    {
        id: "9-f1", session: 9, title: "第9回：公式確認",
        text: "光子のエネルギー $E$ を表す正しい式はどれですか？",
        type: "select", options: ["$E = h\nu = \frac{hc}{\\lambda}$", "$E = \\frac{h}{\\nu}$", "$E = h\\lambda$"],
        answer: "$E = h\\nu = \frac{hc}{\\lambda}$", 
        explanation: "光子のエネルギーは振動数に比例します。"
    },
    {
        id: 15.3, session: 9, title: "演習15(3)",
        text: "$5.0 \text{ MeV}$ の $\alpha$ 粒子が金の原子($Z=79$)に入射するときの最接近距離 $d \text{ [m]}$ を求めよ。",
        type: "input", answer: "4.6e-14", unit: "m", digits: 2,
        explanation: "$d = \frac{2k_0Ze^2}{K}$ です。"
    },
    // --- 第10回 ---
    {
        id: 18.1, session: 10, title: "演習18(1)",
        text: "水素原子の基底状態のエネルギー $E_1 \text{ [J]}$ を求めよ。",
        type: "input", answer: "-2.2e-18", unit: "J", digits: 2,
        explanation: "$E_1 \approx -2.178 \times 10^{-18} \text{ J}$。"
    },
    // --- 第11回 ---
    {
        id: 21, session: 11, title: "演習21",
        text: "$^{27}_{13}\text{Al}$ 原子核に含まれる中性子の数はいくつか。",
        type: "input", answer: "14", unit: "個", digits: 0,
        explanation: "$27 - 13 = 14$ です。"
    },
    // --- 第12回 ---
    {
        id: 26, session: 12, title: "演習26",
        text: "$^{232}_{90}\text{Th} \rightarrow ^{208}_{82}\text{Pb}$ の過程で $\beta$ 崩壊は何回起きるか。",
        type: "input", answer: "4", unit: "回", digits: 0,
        explanation: "$\alpha$崩壊6回、$\beta$崩壊4回です。"
    },
    // --- 第13回 ---
    {
        id: 29, session: 13, title: "演習29",
        text: "割合が $1/8$ の木片の年代（半減期 5700年）。",
        type: "input", answer: "1.7e4", unit: "年前", digits: 2,
        explanation: "$3 \times 5700 = 17100$ 年。"
    }
];

let currentSessionQuestions = [];
let currentQuestionIndex = 0;

function startSession(sessionNum) {
    currentSessionQuestions = questions.filter(q => q.session === sessionNum);
    if (currentSessionQuestions.length === 0) {
        alert("準備中です。");
        return;
    }
    currentQuestionIndex = 0;
    document.getElementById('menu').classList.add('hidden');
    document.getElementById('question-container').classList.remove('hidden');
    showQuestion();
}

function showQuestion() {
    const q = currentSessionQuestions[currentQuestionIndex];
    document.getElementById('question-title').innerText = q.title;
    document.getElementById('question-text').innerHTML = q.text;
    document.getElementById('feedback').classList.add('hidden');
    document.getElementById('next-btn').classList.add('hidden');
    document.getElementById('submit-btn').classList.remove('hidden');

    const area = document.getElementById('interaction-area');
    area.innerHTML = '';

    if (q.type === 'select') {
        const shuffledOptions = [...q.options].sort(() => Math.random() - 0.5);
        shuffledOptions.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = "w-full text-left p-4 border-2 border-slate-200 rounded-xl hover:border-blue-400 transition mb-3 bg-white shadow-sm";
            btn.innerHTML = opt;
            btn.onclick = () => selectOption(btn, opt);
            area.appendChild(btn);
        });
        area.dataset.value = "";
    } else {
        const inputWrap = document.createElement('div');
        inputWrap.className = "flex items-center space-x-3";
        const input = document.createElement('input');
        input.type = "text";
        input.placeholder = "例: 1.5e7 または 14";
        input.className = "flex-1 p-4 border-2 border-slate-200 rounded-xl focus:border-blue-500 outline-none text-xl font-mono";
        input.id = "user-input";
        inputWrap.appendChild(input);
        if (q.unit) {
            const unitLabel = document.createElement('span');
            unitLabel.className = "text-xl font-bold text-slate-600";
            unitLabel.innerText = q.unit;
            inputWrap.appendChild(unitLabel);
        }
        area.appendChild(inputWrap);
    }
    
    renderMath();
}

function renderMath() {
    if (window.MathJax && MathJax.typesetPromise) {
        setTimeout(() => {
            MathJax.typesetPromise([document.getElementById('question-container')]).catch(err => console.log(err));
        }, 50);
    }
}

function selectOption(btn, val) {
    const parent = btn.parentElement;
    Array.from(parent.children).forEach(c => {
        c.classList.remove('border-blue-500', 'bg-blue-50');
        c.classList.add('border-slate-200', 'bg-white');
    });
    btn.classList.replace('border-slate-200', 'border-blue-500');
    btn.classList.add('bg-blue-50');
    parent.dataset.value = val;
}

function checkAnswer() {
    const q = currentSessionQuestions[currentQuestionIndex];
    let isCorrect = false;
    let userVal = "";

    if (q.type === 'select') {
        userVal = document.getElementById('interaction-area').dataset.value;
        if (!userVal) { alert("選択してください"); return; }
        isCorrect = (userVal === q.answer);
    } else {
        const rawInput = document.getElementById('user-input').value.trim().toLowerCase();
        if (!rawInput) { alert("回答を入力してください"); return; }
        const userNum = parseFloat(rawInput);
        const expectedNum = parseFloat(q.answer);
        
        if (q.digits === 0) {
            isCorrect = (Math.abs(userNum - expectedNum) < 0.1);
        } else {
            const formattedUser = userNum.toExponential(q.digits - 1);
            const formattedExpected = expectedNum.toExponential(q.digits - 1);
            isCorrect = (formattedUser === formattedExpected);
        }
    }

    const feedback = document.getElementById('feedback');
    feedback.classList.remove('hidden');
    feedback.className = `mt-6 p-6 rounded-xl border ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`;
    feedback.innerHTML = `
        <p class="text-xl mb-2 ${isCorrect ? 'correct' : 'incorrect'}">${isCorrect ? '✨ 正解！' : '❌ 不正解...'}</p>
        <p class="text-md text-slate-700 mb-4"><strong>正解:</strong> ${q.answer} ${q.unit || ''}</p>
        <div class="mt-4 text-slate-600 text-[0.95rem] explanation-text border-t border-slate-200 pt-4">
            <p class="font-bold text-slate-800 mb-2">【解説】</p>
            ${q.explanation}
        </div>
    `;

    document.getElementById('submit-btn').classList.add('hidden');
    document.getElementById('next-btn').classList.remove('hidden');
    
    renderMath();
}

function nextQuestion() {
    currentQuestionIndex++;
    if (currentQuestionIndex < currentSessionQuestions.length) {
        showQuestion();
    } else {
        alert("セッション完了！");
        backToMenu();
    }
}

function backToMenu() {
    document.getElementById('menu').classList.remove('hidden');
    document.getElementById('question-container').classList.add('hidden');
}
</script>
</body>
</html>